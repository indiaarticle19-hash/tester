<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Prabha Graphics - Catalog" />
  <title>Prabha Graphics — Products</title>

  <!-- Fonts & Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --primary:#D10007;
      --white:#ffffff;
      --dark:#0f172a;
      --muted:#6b7280;
      --bg:#fbfbfd;
      --card:0 10px 30px rgba(2,6,23,0.06);
      --max:1200px;
      --gap:16px;
      --radius:12px;
      --nav-height:72px;
      --break-sm:520px;
      --break-md:900px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      background:var(--bg); color:var(--dark); margin:0; line-height:1.45;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      -webkit-tap-highlight-color: transparent;
    }

    /* Skip link for keyboard users */
    .skip-link{
      position:fixed;left:8px;top:8px;background:#000;color:#fff;padding:8px 12px;border-radius:8px;z-index:9999;transform:translateY(-120%);transition:transform .18s;}
    .skip-link:focus{transform:translateY(0)}

    .container{max-width:var(--max);margin:0 auto;padding:0 20px}

    /* Header */
    .navbar{position:fixed;top:0;left:0;right:0;background:#fff;z-index:1100;transition:all .28s;height:var(--nav-height);display:flex;align-items:center}
    .navbar.scrolled{box-shadow:var(--card);backdrop-filter:blur(4px)}
    .nav-container{width:100%;display:flex;align-items:center;gap:16px;justify-content:space-between}
    .nav-logo{display:flex;align-items:center;gap:12px;cursor:pointer}
    .logo-img{width:44px;height:44px;border-radius:8px;object-fit:contain}
    .logo-text{font-weight:700;font-size:16px}
    .nav-actions{display:flex;gap:12px;align-items:center}

    .nav-links{display:flex;gap:18px;list-style:none;align-items:center;margin:0;padding:0}
    .nav-link{color:var(--dark);text-decoration:none;font-weight:500;position:relative;padding:8px 6px;border-radius:8px}
    .nav-link:hover,.nav-link:focus{background:#fff6f6}
    .cta-btn{background:var(--primary);color:#fff;padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:600;box-shadow:0 6px 18px rgba(209,0,7,0.12)}
    .hamburger{display:none;border:0;background:transparent;font-size:20px;cursor:pointer;color:var(--dark)}

    /* Hero */
    .hero{min-height:220px;background:linear-gradient(90deg,#fff7f7,#fff);display:flex;align-items:center;margin-top:var(--nav-height);padding:28px 0}
    .hero-grid{display:flex;gap:24px;align-items:center;justify-content:space-between}
    .hero h1{font-size:26px;margin:0 0 8px 0}
    .hero p{color:var(--muted);margin:0;max-width:58ch}
    .hero-figure{width:260px;border-radius:12px;overflow:hidden;flex-shrink:0}
    .hero-figure img{width:100%;height:100%;display:block;object-fit:cover}

    /* Categories */
    .categories-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:var(--gap);margin:22px 0}
    .category-card{position:relative;border-radius:var(--radius);overflow:hidden;cursor:pointer;min-height:140px;background:#fff;box-shadow:var(--card);transition:transform .18s,box-shadow .18s}
    .category-card:hover{transform:translateY(-6px);box-shadow:0 18px 40px rgba(2,6,23,0.08)}
    .category-card img{width:100%;height:100%;object-fit:cover;display:block}
    .category-overlay{position:absolute;inset:0;background:linear-gradient(180deg,transparent,rgba(0,0,0,0.45));display:flex;align-items:flex-end;padding:14px;color:#fff}
    .category-overlay h3{margin:0;font-size:16px}
    .category-overlay p{margin:4px 0 0 0;font-size:13px;opacity:0.95}

    /* Product grid */
    .section{margin:18px 0;padding-bottom:6px}
    .section h2{margin:0 0 12px 0;font-size:18px}
    .products-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:14px}
    .product-card{background:#fff;border-radius:12px;overflow:hidden;box-shadow:var(--card);display:flex;flex-direction:column;transition:transform .18s}
    .product-card:hover{transform:translateY(-6px)}
    .product-card img{width:100%;height:180px;object-fit:cover}
    .product-body{padding:12px;display:flex;flex-direction:column;gap:8px}
    .product-title{font-size:15px;font-weight:700}
    .product-vendor{color:var(--muted);font-size:13px}
    .product-desc{color:#334155;font-size:13px}
    .product-footer{display:flex;align-items:center;gap:8px;margin-top:8px}
    .badge{background:#f1f5f9;color:#0f172a;padding:6px 9px;border-radius:999px;font-size:12px}
    .price{font-weight:800;color:var(--primary);margin-left:auto}
    .old{color:#9ca3af;text-decoration:line-through;font-size:13px}

    /* Empty state */
    .empty{padding:24px;border-radius:12px;background:#fff;text-align:center;color:var(--muted);box-shadow:var(--card)}

    /* Modal */
    .modal-bg{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,23,0.45);z-index:2200;padding:18px}
    .modal{width:100%;max-width:980px;background:#fff;border-radius:12px;padding:18px;max-height:92vh;overflow:auto;box-shadow:0 30px 60px rgba(2,6,23,0.22)}
    .modal .top{display:flex;justify-content:space-between;align-items:flex-start;gap:12px;flex-wrap:wrap}
    .modal .left{flex:0 1 420px;min-width:260px}
    .modal .right{flex:1;min-width:240px}
    .main-image{width:100%;height:420px;object-fit:cover;border-radius:10px;border:1px solid #f1f5f9;background:#fff;display:block}
    .thumbs{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
    .thumbs img{width:68px;height:68px;object-fit:cover;border-radius:8px;border:2px solid transparent;cursor:pointer}
    .thumbs img.active{border-color:var(--primary)}
    .rating{display:flex;gap:6px;align-items:center;color:#b45309;font-weight:600}
    .price-row{display:flex;gap:12px;align-items:baseline;margin:10px 0}
    .price-row .big{font-size:22px;color:var(--primary);font-weight:800}
    .saving{color:#065f46;background:#dcfce7;padding:6px 8px;border-radius:8px;font-weight:600}
    .stock{color:var(--muted);margin-top:4px}
    .meta-row{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .meta{background:#f8fafc;padding:8px 10px;border-radius:8px;font-size:13px;color:var(--muted)}
    .specs{margin-top:12px;border-radius:8px;padding:12px;background:#fff;border:1px solid #eef2f7}
    .specs table{width:100%;border-collapse:collapse;font-size:14px}
    .specs td{padding:6px 8px;border-bottom:1px dashed #f1f5f9;color:var(--muted)}
    .specs td:first-child{width:40%;color:#374151;font-weight:600}
    .tags{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .tag{background:#f1f5f9;padding:6px 10px;border-radius:999px;font-size:13px;color:#111}
    .trust{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .trust .meta{display:flex;gap:8px;align-items:center}

    .actions{display:flex;gap:10px;margin-top:14px;flex-wrap:wrap}
    .btn{background:var(--primary);color:#fff;padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:700}
    .btn.ghost{background:#fff;border:1px solid #e5e7eb;color:var(--dark)}
    .btn.secondary{background:#334155}

    /* Order modal */
    .form-row{display:flex;gap:10px;margin-top:8px}
    .form-row > *{flex:1}
    input,select,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #e6e7eb;font-size:14px}
    textarea{resize:vertical}
    .o-msg{margin-top:10px}

    /* Footer */
    .footer{background:#0b1220;color:#fff;padding:48px 0;margin-top:28px}
    .footer-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:20px;align-items:start}
    .footer-col{display:flex;flex-direction:column;gap:10px}
    .footer-brand{display:flex;align-items:center;gap:12px}
    .footer-logo{width:44px;height:44px;object-fit:contain;border-radius:8px;background:var(--primary);padding:6px}
    .footer-title{color:#fff;margin:0;font-size:16px}
    .footer-list{list-style:none;padding:0;margin:0;color:#9aa3b2;display:flex;flex-direction:column;gap:8px}
    .footer-contact{color:#9aa3b2;margin:0;display:flex;gap:8px;align-items:center}

    /* Responsive */
    @media (max-width:900px){
      .nav-links{display:none;position:fixed;inset:var(--nav-height) 12px auto 12px;background:#fff;border-radius:10px;padding:16px;flex-direction:column;gap:12px;box-shadow:0 12px 60px rgba(2,6,23,0.08);max-height:70vh;overflow:auto}
      .nav-links.show{display:flex}
      .hamburger{display:block}
      .nav-container{padding:10px 14px}
      .main-image{height:320px}
      .hero-grid{flex-direction:column;align-items:flex-start}
      .hero-figure{width:100%;max-width:360px}
    }
    @media (max-width:520px){
      .hero{min-height:200px;padding:18px 0}
      .product-card img{height:140px}
      .logo-text{display:none}
      .main-image{height:220px}
      .products-grid{grid-template-columns:repeat(auto-fit,minmax(150px,1fr))}
      .thumbs img{width:56px;height:56px}
    }

    /* focus styles */
    :focus{outline:3px solid rgba(209,0,7,0.18);outline-offset:2px}
  </style>
</head>
<body>
  <a class="skip-link" href="#main">Skip to main content</a>

  <!-- Header -->
  <nav class="navbar" id="navbar" aria-label="Primary Navigation">
    <div class="nav-container container" id="navContainer">
      <div class="nav-logo" id="navLogo" onclick="location.href='index.html'" role="button" tabindex="0">
        <img src="logo.png" alt="Prabha Graphics" class="logo-img"/>
        <span class="logo-text">Prabha Graphics</span>
      </div>

      <button class="hamburger" id="hambBtn" aria-expanded="false" aria-controls="navLinks" aria-label="Open menu" title="Menu">
        <i class="fa fa-bars" aria-hidden="true"></i>
      </button>

      <ul class="nav-links" id="navLinks" role="menubar">
        <li role="none"><a class="nav-link" role="menuitem" href="index.html#home">Home</a></li>
        <li role="none"><a class="nav-link" role="menuitem" href="index.html#about">About Us</a></li>
        <li role="none"><a class="nav-link" role="menuitem" href="products.html#corporate">Corporate Gifts</a></li>
        <li role="none"><a class="nav-link" role="menuitem" href="products.html#personalized">Personalized Gifts</a></li>
        <li role="none"><a class="nav-link" role="menuitem" href="products.html#business">Business Essentials</a></li>
        <li role="none"><a class="nav-link" role="menuitem" href="index.html#contact">Contact Us</a></li>
      </ul>

      <div class="nav-actions">
        <button class="cta-btn" onclick="location.href='get-a-quote.html'">Get a Quote</button>
      </div>
    </div>
  </nav>

  <!-- HERO -->
  <main id="main">
    <section class="hero" aria-labelledby="heroTitle">
      <div class="container hero-grid">
        <div class="left">
          <h1 id="heroTitle">All Products — Find exactly what you need</h1>
          <p>Browse corporate gifts, promotional items, personalized treasures, business essentials and ready-made products. Tap a category or use the search (coming soon) to jump straight to what you want.</p>
        </div>
        <figure class="hero-figure" aria-hidden="true">
          <img loading="lazy" decoding="async" src="https://images.unsplash.com/photo-1556821552-5f73541e6b1e?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&q=80&w=600" alt="Catalog hero"/>
        </figure>
      </div>
    </section>

    <div class="container" style="padding-top:6px;">
      <!-- Category cards -->
      <div class="categories-grid" role="list" aria-label="Product categories">
        <div class="category-card" role="listitem" onclick="scrollToSection('corporate')" tabindex="0" onkeypress="if(event.key==='Enter')scrollToSection('corporate')">
          <img loading="lazy" decoding="async" src="https://images.unsplash.com/photo-1612521334484-bfb1f3f0cedc?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&q=80&w=800" alt="Corporate"/>
          <div class="category-overlay"><div><h3>Corporate & Promotional</h3><p>Keychains, Pens, Gift Sets</p></div></div>
        </div>
        <div class="category-card" role="listitem" onclick="scrollToSection('personalized')" tabindex="0" onkeypress="if(event.key==='Enter')scrollToSection('personalized')">
          <img loading="lazy" decoding="async" src="https://images.unsplash.com/photo-1572302265669-2acefa827fca?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&q=80&w=800" alt="Personalized"/>
          <div class="category-overlay"><div><h3>Personalized Gifts</h3><p>Mugs, Cushions, Photo Gifts</p></div></div>
        </div>
        <div class="category-card" role="listitem" onclick="scrollToSection('business')" tabindex="0" onkeypress="if(event.key==='Enter')scrollToSection('business')">
          <img loading="lazy" decoding="async" src="https://images.unsplash.com/photo-1599909695241-b6c7e2ae4e6e?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&q=80&w=800" alt="Business"/>
          <div class="category-overlay"><div><h3>Business Essentials</h3><p>Visiting cards, Stationery</p></div></div>
        </div>
        <div class="category-card" role="listitem" onclick="scrollToSection('apparel')" tabindex="0" onkeypress="if(event.key==='Enter')scrollToSection('apparel')">
          <img loading="lazy" decoding="async" src="https://images.unsplash.com/photo-1586419604178-25ade1770efc?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&q=80&w=800" alt="Apparel"/>
          <div class="category-overlay"><div><h3>Apparel</h3><p>T-Shirts, Polo, Jackets</p></div></div>
        </div>
      </div>

      <!-- Product Sections -->
      <section id="corporate" class="section" aria-label="Corporate Gifts Section">
        <h2>Corporate & Promotional</h2>
        <div id="corporateGrid" class="products-grid" aria-live="polite" aria-busy="false"></div>
        <div id="corporateEmpty" class="empty" style="display:none">No products found in this category.</div>
      </section>

      <section id="personalized" class="section" aria-label="Personalized Gifts Section">
        <h2>Personalized Gifts</h2>
        <div id="personalizedGrid" class="products-grid" aria-live="polite" aria-busy="false"></div>
        <div id="personalizedEmpty" class="empty" style="display:none">No products found in this category.</div>
      </section>

      <section id="business" class="section" aria-label="Business Essentials Section">
        <h2>Business Essentials</h2>
        <div id="businessGrid" class="products-grid" aria-live="polite" aria-busy="false"></div>
        <div id="businessEmpty" class="empty" style="display:none">No products found in this category.</div>
      </section>

      <section id="apparel" class="section" aria-label="Apparel Section">
        <h2>Apparel & Wearables</h2>
        <div id="apparelGrid" class="products-grid" aria-live="polite" aria-busy="false"></div>
        <div id="apparelEmpty" class="empty" style="display:none">No products found in this category.</div>
      </section>

      <section id="other" class="section" aria-label="Other Products Section">
        <h2>Other Products</h2>
        <div id="otherGrid" class="products-grid" aria-live="polite" aria-busy="false"></div>
        <div id="otherEmpty" class="empty" style="display:none">No products found in this category.</div>
      </section>
    </div>

    <!-- Product detail modal (accessible) -->
    <div id="detailModal" class="modal-bg" role="dialog" aria-hidden="true" aria-labelledby="dTitle" aria-modal="true">
      <div class="modal" role="document">
        <div class="top">
          <div>
            <h2 id="dTitle" style="margin:0"></h2>
            <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
              <div class="rating" id="dRating"><i class="fa fa-star" aria-hidden="true"></i> <span id="dRatingVal">4.7</span></div>
              <span class="badge" id="dAvailability">In stock</span>
              <span class="badge" id="dDeliveryBadge">Delivery in 3-6 days</span>
              <span class="badge" id="dSkuBadge">SKU: —</span>
            </div>
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <button class="btn ghost" id="detailCloseBtn" aria-label="Close product details">Close</button>
          </div>
        </div>

        <div style="display:flex;gap:18px;margin-top:12px;flex-wrap:wrap">
          <div class="left">
            <img id="dMainImage" class="main-image" src="" alt="product image" loading="lazy" decoding="async"/>
            <div class="thumbs" id="dThumbs" aria-hidden="false"></div>
            <div class="tags" id="dTagList" aria-hidden="false"></div>
            <div class="trust">
              <div class="meta"><i class="fa fa-shield-alt" aria-hidden="true"></i> Secure payments</div>
              <div class="meta"><i class="fa fa-undo" aria-hidden="true"></i> Easy returns</div>
              <div class="meta"><i class="fa fa-truck" aria-hidden="true"></i> Fast delivery</div>
            </div>
          </div>

          <div class="right">
            <div id="dShortDesc" style="color:#111"></div>

            <div class="price-row" aria-live="polite">
              <div class="big" id="dPrice">₹0</div>
              <div class="old" id="dOldPrice"></div>
              <div class="saving" id="dSaving" style="display:none"></div>
            </div>
            <div class="stock" id="dStockInfo">Stock: -</div>

            <div class="meta-row">
              <div class="meta" id="dDimensions">Dimensions: -</div>
              <div class="meta" id="dMaterial">Material: -</div>
              <div class="meta" id="dWeight">Weight: -</div>
            </div>

            <div style="margin-top:12px" id="dVariant"></div>

            <div class="specs" style="margin-top:12px">
              <table id="dSpecsTable" aria-hidden="false"></table>
            </div>

            <div class="actions">
              <button class="btn" id="dWhats"><i class="fa fa-whatsapp" style="margin-right:8px" aria-hidden="true"></i> WhatsApp</button>
              <button class="btn secondary" id="dOrder">Order Now</button>
              <button class="btn ghost" id="dShareBtn">Share</button>
            </div>

            <div style="margin-top:10px;color:var(--muted);font-size:13px" id="dVendor">Seller: —</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Order modal -->
    <div id="orderModal" class="modal-bg" aria-hidden="true" aria-modal="true">
      <div class="modal" role="document">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h3 id="orderTitle">Place Order</h3>
          <button class="btn ghost" id="orderCloseBtn" aria-label="Close order form">Close</button>
        </div>

        <form id="orderForm" style="margin-top:12px" novalidate>
          <div class="form-row">
            <label style="display:none" for="oName">Full name</label>
            <input id="oName" placeholder="Full name" required aria-required="true"/>
            <label style="display:none" for="oPhone">Phone</label>
            <input id="oPhone" placeholder="Phone (required)" required aria-required="true"/>
          </div>
          <div class="form-row">
            <label style="display:none" for="oEmail">Email</label>
            <input id="oEmail" placeholder="Email (optional)" type="email"/>
          </div>

          <div class="form-row">
            <label style="display:none" for="oLine1">Address line 1</label>
            <input id="oLine1" placeholder="Address line 1 (house/building/street)"/>
          </div>
          <div class="form-row">
            <label style="display:none" for="oLine2">Address line 2</label>
            <input id="oLine2" placeholder="Address line 2 (area/landmark)"/>
          </div>
          <div class="form-row">
            <label style="display:none" for="oCity">City</label>
            <input id="oCity" placeholder="City"/>
            <label style="display:none" for="oState">State</label>
            <input id="oState" placeholder="State"/>
          </div>
          <div class="form-row">
            <label style="display:none" for="oPincode">Pincode</label>
            <input id="oPincode" placeholder="Pincode"/>
            <label style="display:none" for="oCountry">Country</label>
            <input id="oCountry" placeholder="Country" value="India"/>
          </div>

          <div id="orderVariantBlock" style="margin-top:10px"></div>

          <div class="form-row">
            <label style="display:none" for="oQty">Quantity</label>
            <input id="oQty" type="number" min="1" value="1"/>
            <label style="display:none" for="oPayment">Payment method</label>
            <select id="oPayment" aria-label="Payment method"><option>COD</option><option>Online</option></select>
          </div>

          <textarea id="oNote" placeholder="Additional note (optional)" rows="3" style="margin-top:8px"></textarea>

          <label style="display:flex;align-items:center;gap:8px;margin-top:8px">
            <input type="checkbox" id="oWhatsapp" /> <span style="color:var(--muted)">Also send this order via WhatsApp</span>
          </label>

          <div id="oMsg" class="o-msg" aria-live="polite"></div>

          <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
            <button class="btn" type="submit">Submit Order</button>
            <button type="button" class="btn ghost" id="orderCancelBtn">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Footer -->
    <footer class="footer" id="contact">
      <div class="container footer-grid">
        <div class="footer-col">
          <div class="footer-brand">
            <img src="logo.png" alt="Prabha Graphics" class="footer-logo"/>
            <strong style="color:#fff">Prabha Graphics</strong>
          </div>
          <p style="color:#9aa3b2;margin:0">Your trusted partner in Lucknow for all corporate and personalized printing and gifting needs.</p>
        </div>

        <div class="footer-col">
          <h4 class="footer-title">Quick Links</h4>
          <ul class="footer-list"><li>T-Shirts</li><li>Mugs</li><li>Keychains</li></ul>
        </div>

        <div class="footer-col">
          <h4 class="footer-title">Company</h4>
          <ul class="footer-list"><li>About Us</li><li>Contact Us</li><li><a href="get-a-quote.html" style="color:#9aa3b2">View Full Catalog</a></li></ul>
        </div>

        <div class="footer-col">
          <h4 class="footer-title">Contact Us</h4>
          <p class="footer-contact"><i class="fas fa-phone" aria-hidden="true"></i> 074579 94888</p>
          <p class="footer-contact"><i class="fas fa-map-marker-alt" aria-hidden="true"></i> Shop No. 4/74, Gomti Nagar, Lucknow, 226010</p>
          <p class="footer-contact"><i class="fas fa-globe" aria-hidden="true"></i> www.prabhagraphics.in</p>
        </div>
      </div>

      <div style="height:1px;background:linear-gradient(to right, transparent, rgba(209,0,7,0.15), transparent);margin:18px 0"></div>
      <div style="text-align:center;color:#9aa3b2">&copy; 2025 Prabha Graphics. All rights reserved.</div>
    </footer>
  </main>

  <!-- Firebase + App Logic (keeps original functionality, improved accessibility & focus handling) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
    import { getFirestore, collection, query, orderBy, onSnapshot, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAj405kZSn-V6rOKE1BurRE3meYCGZ_wbU",
      authDomain: "prabha-graphics-7d269.firebaseapp.com",
      projectId: "prabha-graphics-7d269",
      storageBucket: "prabha-graphics-7d269.appspot.com",
      messagingSenderId: "968671773486",
      appId: "1:968671773486:web:234c477f4ba267f31770bf",
      measurementId: "G-52C61FGY39"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const shopPhone = "917457994888"; // wa.me format

    // Grid refs
    const corporateGrid = document.getElementById('corporateGrid');
    const personalizedGrid = document.getElementById('personalizedGrid');
    const businessGrid = document.getElementById('businessGrid');
    const apparelGrid = document.getElementById('apparelGrid');
    const otherGrid = document.getElementById('otherGrid');

    // Empty placeholders
    const empties = {
      corporate: document.getElementById('corporateEmpty'),
      personalized: document.getElementById('personalizedEmpty'),
      business: document.getElementById('businessEmpty'),
      apparel: document.getElementById('apparelEmpty'),
      other: document.getElementById('otherEmpty')
    };

    // Detail modal refs
    const detailModal = document.getElementById('detailModal');
    const dTitle = document.getElementById('dTitle');
    const dMainImage = document.getElementById('dMainImage');
    const dThumbs = document.getElementById('dThumbs');
    const dShortDesc = document.getElementById('dShortDesc');
    const dPrice = document.getElementById('dPrice');
    const dOldPrice = document.getElementById('dOldPrice');
    const dSaving = document.getElementById('dSaving');
    const dStockInfo = document.getElementById('dStockInfo');
    const dVariant = document.getElementById('dVariant');
    const dVendor = document.getElementById('dVendor');
    const dTagList = document.getElementById('dTagList');
    const dDimensions = document.getElementById('dDimensions');
    const dMaterial = document.getElementById('dMaterial');
    const dWeight = document.getElementById('dWeight');
    const dSpecsTable = document.getElementById('dSpecsTable');
    const dDeliveryBadge = document.getElementById('dDeliveryBadge');
    const dSkuBadge = document.getElementById('dSkuBadge');
    const dAvailability = document.getElementById('dAvailability');
    const dWhats = document.getElementById('dWhats');
    const dOrderBtn = document.getElementById('dOrder');
    const dShareBtn = document.getElementById('dShareBtn');
    const detailCloseBtn = document.getElementById('detailCloseBtn');

    // Order modal refs
    const orderModal = document.getElementById('orderModal');
    const orderForm = document.getElementById('orderForm');
    const orderVariantBlock = document.getElementById('orderVariantBlock');
    const oMsg = document.getElementById('oMsg');
    const orderCloseBtn = document.getElementById('orderCloseBtn');
    const orderCancelBtn = document.getElementById('orderCancelBtn');

    let activeProduct = null;

    // Real-time products
    const qProducts = query(collection(db, 'products'), orderBy('createdAt', 'desc'));
    onSnapshot(qProducts, snapshot => {
      // Clear grids
      corporateGrid.innerHTML = personalizedGrid.innerHTML = businessGrid.innerHTML = apparelGrid.innerHTML = otherGrid.innerHTML = '';
      const counts = {corporate:0,personalized:0,business:0,apparel:0,other:0};

      snapshot.forEach(docSnap => {
        const p = docSnap.data(); p.id = docSnap.id;
        const card = createProductCard(p);
        const cat = (p.category || '').toLowerCase();
        if (cat.includes('corporate') || cat.includes('promot')) { corporateGrid.appendChild(card); counts.corporate++; }
        else if (cat.includes('personal')) { personalizedGrid.appendChild(card); counts.personalized++; }
        else if (cat.includes('business') || cat.includes('essent')) { businessGrid.appendChild(card); counts.business++; }
        else if (cat.includes('apparel') || cat.includes('shirt') || cat.includes('t-shirt')) { apparelGrid.appendChild(card); counts.apparel++; }
        else { otherGrid.appendChild(card); counts.other++; }
      });

      // toggle empties
      Object.keys(empties).forEach(k => empties[k].style.display = (counts[k] === 0 ? 'block' : 'none'));

      // preserve hash scroll
      setTimeout(()=> {
        const h = location.hash.replace('#','');
        if (h) scrollToSection(h);
      }, 200);
    });

    function createProductCard(p){
      const card = document.createElement('div');
      card.className = 'product-card';
      const discount = p.oldPrice && p.price && p.oldPrice > p.price ? Math.round(((p.oldPrice - p.price)/p.oldPrice)*100) : 0;
      const img = (p.images && p.images[0]) || p.image || '';
      card.innerHTML = `
        <img loading="lazy" decoding="async" src="${escapeHtml(img)}" alt="${escapeHtml(p.name)}"/>
        <div class="product-body">
          <div>
            <div class="product-title">${escapeHtml(p.name)}</div>
            <div class="product-vendor">${escapeHtml(p.vendor||'')}</div>
          </div>
          <div class="product-desc">${escapeHtml((p.description||'').slice(0,90))}...</div>
          <div class="product-footer">
            ${discount ? `<span class="badge">-${discount}%</span>` : `<span class="badge">${escapeHtml(p.type||'ready')}</span>`}
            ${p.oldPrice ? `<span class="old">₹${escapeHtml(String(p.oldPrice))}</span>` : ''}
            <div class="price">₹${escapeHtml(String(p.price||0))}</div>
            <button class="btn" type="button" onclick='openDetail("${p.id}")' aria-label="View product details">View</button>
          </div>
        </div>
      `;
      card.dataset.productId = p.id;
      window._prabhaProducts = window._prabhaProducts || {}; window._prabhaProducts[p.id] = p;
      return card;
    }

    // Scroll helper
    function scrollToSection(id){
      const el = document.getElementById(id);
      if (!el) return;
      el.scrollIntoView({behavior:'smooth', block:'start'});
      el.style.boxShadow = '0 10px 30px rgba(209,0,7,0.12)';
      setTimeout(()=> el.style.boxShadow = '', 1300);
    }
    window.scrollToSection = scrollToSection;

    // Open detail
    window.openDetail = function(id){
      const p = window._prabhaProducts && window._prabhaProducts[id];
      if (!p) return alert('Product not found');
      activeProduct = p;

      dTitle.textContent = p.name || '';
      dMainImage.src = (p.images && p.images[0]) || p.image || '';
      dThumbs.innerHTML = '';
      (p.images || []).forEach((u, i) => {
        const t = document.createElement('img'); t.src = u; if(i===0) t.classList.add('active');
        t.onclick = () => { dMainImage.src = u; Array.from(dThumbs.children).forEach(c=>c.classList.remove('active')); t.classList.add('active'); };
        dThumbs.appendChild(t);
      });

      dShortDesc.textContent = p.shortDescription || (p.description || '').slice(0,220);
      dPrice.textContent = '₹' + (p.price || 0);
      dOldPrice.textContent = p.oldPrice ? '₹' + p.oldPrice : '';
      if(p.oldPrice && p.price && p.oldPrice > p.price){
        dSaving.style.display='inline-block'; dSaving.textContent = 'Save ₹' + (p.oldPrice - p.price);
      } else { dSaving.style.display='none'; }

      dStockInfo.textContent = (p.variants && p.variants.length) ? ('Variants: '+p.variants.length) : ('Stock: '+(p.stock||0));
      dDeliveryBadge.textContent = p.deliveryEstimate || 'Delivery in 3-6 days';
      dSkuBadge.textContent = 'SKU: ' + (p.sku || '—');
      dAvailability.textContent = (p.stock > 0 || (p.variants && p.variants.some(v=>v.stock>0))) ? 'In stock' : 'Out of stock';

      // Meta fields
      dDimensions.textContent = 'Dimensions: ' + (p.dimensions || '-');
      dMaterial.textContent = 'Material: ' + (p.material || '-');
      dWeight.textContent = 'Weight: ' + (p.weight || '-');

      // Specs table
      dSpecsTable.innerHTML = '';
      const specRows = [
        ['SKU', p.sku || '-'],
        ['Brand', p.brand || p.vendor || '-'],
        ['Material', p.material || '-'],
        ['Dimensions', p.dimensions || '-'],
        ['Weight', p.weight || '-'],
        ['Type', p.type || '-'],
        ['Category', p.category || '-'],
        ['Warranty', p.warranty || '-']
      ];
      specRows.forEach(([k,v])=>{
        const tr = document.createElement('tr'); tr.innerHTML = `<td>${escapeHtml(k)}</td><td>${escapeHtml(v)}</td>`;
        dSpecsTable.appendChild(tr);
      });

      // Tags
      dTagList.innerHTML = '';
      (p.tags || []).forEach(t => {
        const s = document.createElement('span'); s.className='tag'; s.textContent = t; dTagList.appendChild(s);
      });

      // Variants
      dVariant.innerHTML = '';
      if (p.variants && p.variants.length){
        const s = document.createElement('select'); s.id='modalVariantSelect';
        s.innerHTML = '<option value="">Select variant</option>';
        p.variants.forEach(v => {
          const opt = document.createElement('option');
          opt.value = encodeURIComponent(JSON.stringify(v));
          opt.textContent = `${v.label}${v.price ? ' - ₹'+v.price : ''}${v.stock ? ' ('+v.stock+' in stock)' : ''}`;
          s.appendChild(opt);
        });
        s.onchange = () => {
          if (!s.value) { dPrice.textContent = '₹' + (p.price||0); dStockInfo.textContent = 'Stock: '+(p.stock||0); return; }
          const v = JSON.parse(decodeURIComponent(s.value));
          dPrice.textContent = '₹' + (v.price || p.price || 0);
          dStockInfo.textContent = v.stock ? ('Stock: '+v.stock) : ('Stock: '+(p.stock||0));
        };
        dVariant.appendChild(s);
      }

      // Seller + actions
      dVendor.textContent = 'Seller: ' + (p.vendor || 'Prabha Graphics');

      dWhats.onclick = ()=> {
        const msg = `Hi, query about: ${p.name} (SKU: ${p.sku || '-'})`;
        window.open(`https://wa.me/${shopPhone}?text=${encodeURIComponent(msg)}`, '_blank');
      };

      if (p.type === 'customized'){
        dOrderBtn.style.display = 'none';
      } else {
        dOrderBtn.style.display = 'inline-block';
        dOrderBtn.onclick = ()=> openOrderModal(p);
      }

      dShareBtn.onclick = () => {
        const url = location.origin + location.pathname + '#product-' + encodeURIComponent(p.id);
        if (navigator.share) {
          navigator.share({title: p.name, text: p.shortDescription || '', url }).catch(()=>{});
        } else {
          navigator.clipboard?.writeText(url).then(()=> alert('Product link copied to clipboard'));
        }
      };

      // Show modal with focus management
      detailModal.style.display = 'flex';
      detailModal.setAttribute('aria-hidden','false');
      document.body.style.overflow = 'hidden';
      trapFocus(detailModal);
    };

    function closeDetail(){
      detailModal.style.display='none';
      detailModal.setAttribute('aria-hidden','true');
      activeProduct=null;
      document.body.style.overflow = '';
    }

    // Order modal
    function openOrderModal(p){
      activeProduct = p;
      orderVariantBlock.innerHTML = '';

      if (p.variants && p.variants.length){
        const sel = document.createElement('select'); sel.id = 'orderVariant';
        sel.innerHTML = '<option value="">Select variant</option>';
        p.variants.forEach(v=> sel.innerHTML += `<option value='${encodeURIComponent(JSON.stringify(v))}'>${v.label}${v.price?' - ₹'+v.price:''}${v.stock?' ('+v.stock+' in stock)':''}</option>`);
        orderVariantBlock.appendChild(sel);
      }
      if (p.sizes && p.sizes.length){
        const sel2 = document.createElement('select'); sel2.id='orderSize';
        sel2.innerHTML = '<option value="">Select size</option>';
        p.sizes.forEach(s=> sel2.innerHTML += `<option>${s}</option>`);
        orderVariantBlock.appendChild(sel2);
      }
      if (p.colors && p.colors.length){
        const sel3 = document.createElement('select'); sel3.id='orderColor';
        sel3.innerHTML = '<option value="">Select color</option>';
        p.colors.forEach(c=> sel3.innerHTML += `<option>${c}</option>`);
        orderVariantBlock.appendChild(sel3);
      }
      orderModal.style.display='flex'; orderModal.setAttribute('aria-hidden','false');
      document.body.style.overflow='hidden';
      trapFocus(orderModal);
    }
    function closeOrder(){
      orderModal.style.display='none'; orderModal.setAttribute('aria-hidden','true');
      orderForm.reset(); oMsg.innerHTML=''; document.body.style.overflow='';
    }

    // Submit order -> Firestore
    orderForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!activeProduct) return showOrderError('No product selected.');
      const name = document.getElementById('oName').value.trim();
      const phone = document.getElementById('oPhone').value.trim();
      if (!name || !phone) return showOrderError('Name and phone required.');
      const email = document.getElementById('oEmail').value.trim();
      const line1 = document.getElementById('oLine1').value.trim();
      const line2 = document.getElementById('oLine2').value.trim();
      const city = document.getElementById('oCity').value.trim();
      const state = document.getElementById('oState').value.trim();
      const pincode = document.getElementById('oPincode').value.trim();
      const country = document.getElementById('oCountry').value.trim();
      const qty = parseInt(document.getElementById('oQty').value) || 1;
      const note = document.getElementById('oNote').value.trim();
      const alsoWhats = document.getElementById('oWhatsapp').checked;
      const paymentMethod = document.getElementById('oPayment').value;

      let variant = null;
      const vsel = document.getElementById('orderVariant');
      if (vsel && vsel.value) variant = JSON.parse(decodeURIComponent(vsel.value));

      const size = document.getElementById('orderSize') ? document.getElementById('orderSize').value : '';
      const color = document.getElementById('orderColor') ? document.getElementById('orderColor').value : '';

      const order = {
        productId: activeProduct.id,
        productName: activeProduct.name,
        productSnapshot: {
          name: activeProduct.name,
          sku: activeProduct.sku || '',
          images: activeProduct.images || [],
          vendor: activeProduct.vendor || ''
        },
        productType: activeProduct.type || 'ready-made',
        variantId: variant ? variant.id : '',
        variantLabel: variant ? variant.label : '',
        variantPrice: variant ? (variant.price || activeProduct.price) : activeProduct.price,
        selectedSize: size || '',
        selectedColor: color || '',
        quantity: qty,
        customerName: name,
        customerPhone: phone,
        customerEmail: email || '',
        address: { line1, line2, city, state, pincode, country },
        paymentMethod,
        note: note || '',
        status: 'pending',
        createdAt: serverTimestamp()
      };

      try {
        const ordersCol = collection(db, 'orders');
        await addDoc(ordersCol, order);
        showOrderSuccess('Order saved. We will contact you soon.');
        if (alsoWhats){
          const lines = [
            `New order - ${activeProduct.name}`,
            `Qty: ${qty}`,
            `Size: ${order.selectedSize || '-'}`,
            `Color: ${order.selectedColor || '-'}`,
            `Name: ${name}`,
            `Phone: ${phone}`,
            `Address: ${line1} ${line2}, ${city} - ${pincode}`,
            `Note: ${note || '-'}`
          ].join('\n');
          setTimeout(()=> window.open(`https://wa.me/${shopPhone}?text=${encodeURIComponent(lines)}`, '_blank'), 700);
        }
        setTimeout(()=> closeOrder(), 900);
      } catch (err) {
        console.error('order save failed', err);
        showOrderError('Could not submit order: '+ err.message);
      }
    });

    function showOrderError(msg){ oMsg.innerHTML = `<div style="background:#fee2e2;padding:10px;border-radius:8px;color:#991b1b">${escapeHtml(msg)}</div>`; }
    function showOrderSuccess(msg){ oMsg.innerHTML = `<div style="background:#dcfce7;padding:10px;border-radius:8px;color:#065f46">${escapeHtml(msg)}</div>`; }

    // Helpers
    function escapeHtml(s=''){ return String(s).replace(/[&<>\"']/g, m=> ({'&':'&amp;','<':'&lt;','>':'&gt;', '"':'&quot;',"'":'&#39;'})[m]); }

    // Header behavior
    const navbar = document.getElementById('navbar');
    const navLinks = document.getElementById('navLinks');
    const hambBtn = document.getElementById('hambBtn');

    window.addEventListener('scroll', () => {
      const y = window.scrollY || window.pageYOffset;
      if (y > 8) navbar.classList.add('scrolled'); else navbar.classList.remove('scrolled');
    }, {passive:true});

    hambBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      const open = navLinks.classList.toggle('show');
      hambBtn.setAttribute('aria-expanded', open ? 'true' : 'false');
      hambBtn.classList.toggle('open');
      if (open) trapFocus(navLinks); else releaseTrap();
    });
    document.addEventListener('click', (e) => {
      if (!navLinks.contains(e.target) && !hambBtn.contains(e.target) && navLinks.classList.contains('show')) {
        navLinks.classList.remove('show'); hambBtn.setAttribute('aria-expanded','false');
      }
    });

    // Close buttons and Escape support
    detailCloseBtn.addEventListener('click', closeDetail);
    orderCloseBtn.addEventListener('click', closeOrder);
    orderCancelBtn.addEventListener('click', closeOrder);
    document.addEventListener('keydown', (e)=>{
      if (e.key === 'Escape') {
        if (detailModal.style.display==='flex') closeDetail();
        if (orderModal.style.display==='flex') closeOrder();
        if (navLinks.classList.contains('show')) navLinks.classList.remove('show');
      }
    });

    // Hash open product
    window.addEventListener('load', ()=> {
      const h = location.hash.replace('#','');
      if (h.startsWith('product-')) {
        const id = decodeURIComponent(h.replace('product-',''));
        setTimeout(()=>{ if(window._prabhaProducts && window._prabhaProducts[id]) openDetail(id); }, 400);
      }
    });

    // Simple focus trap (works for modal and small menu)
    let _trap = null;
    function trapFocus(container){
      releaseTrap();
      const focusable = container.querySelectorAll('a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])');
      const first = focusable[0];
      const last = focusable[focusable.length-1];
      _trap = function(e){
        if (e.key === 'Tab'){
          if (e.shiftKey && document.activeElement === first) { e.preventDefault(); last.focus(); }
          else if (!e.shiftKey && document.activeElement === last) { e.preventDefault(); first.focus(); }
        }
      };
      container.addEventListener('keydown', _trap);
      // focus first element
      setTimeout(()=> first && first.focus(), 50);
    }
    function releaseTrap(){ if(!_trap) return; document.removeEventListener('keydown', _trap); _trap = null; }

  </script>
</body>
</html>
